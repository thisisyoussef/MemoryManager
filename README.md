
# P2 - Memory Management and Layering

## Description
The data structure used to manage memory was one doubly linked list. Each node represents a block of memory that either contains memory or is a hole.

### Functions

- **`MemoryManager::initialize(size_t sizeInWords)`**
  - Ensures the requested size is less than 65535 then proceeds to instantiate the Memory Manager’s size in words.
  - Releases the memory block acquired through previous initialization by iterating through the linked list.
  - Uses `sbrk` to increase the end of accessible data space by the bytes needed.

- **`MemoryManager::shutdown()`**
  - Uses `sbrk` to decrease the end of accessible data space by the bytes initialized.
  - Iterates through the linked list and deletes all memory allocated within the nodes.

- **`MemoryManager::allocate(size_t sizeInBytes)`**
  - Gets offset by converting the address using `bestFit` or `worstFit` function and updates length of hole to place memory in.
  - Deletes the list dynamically allocated by `getList()` to avoid memory leaks.
  - If space for memory exists, creates a new node in place of the selected hole.

- **`MemoryManager::free(void *address)`**
  - Converts address to an offset.
  - Iterates through the linked list and assigns holes to true if they are equal to the offset to free them for incoming memory.
  - Iterates through the linked list a second time and combines any adjacent holes into one.

- **`MemoryManager::dumpMemoryMap(char *filename)`**
  - Writes the hole list to filename as text by casting the linked list to a list of integers.
  - Deletes the list to leave no memory leaks.

- **`MemoryManager::getList()`**
  - Iterates through linked list and updates list.
  - Places all holes into a vector. Stores every two values as the start and length of the hole.

- **`MemoryManager::getBitmap()`**
  - Utilizes bit shifting to return a bit stream of bits in an array representing whether the words are used or free.
  - Uses linked list iteration and checks the `isHole` variable within each node.

- **`bestFit(int sizeInWords, void *list)`**
  - Casts Linked List to integer list, iterates and returns the offset by the best fit memory algorithm.

- **`worstFit(int sizeInWords, void *list)`**
  - Casts Linked List to integer list, iterates and returns the offset by the worst fit memory algorithm.

## Testing
The `CommandLineTest.cpp` file was used to test base level functionality for the functions. In addition, it was run using valgrind to detect memory leaks.

## Bugs
Major bugs encountered had to do with memory leaks. This often occurred when lists generated by `getList()` weren’t deleted. It was eventually solved by utilizing the `delete[]` keyword on list.

## Link
[Project Demo](https://youtu.be/5EFC-DO7_CQ)

## References/Citations
- [RIT Lecture on Garbage Collection](https://www.cs.rit.edu/~ark/lectures/gc/03_00_00.html)
- [IBM DeveloperWorks on Data Alignment](https://www.ibm.com/developerworks/library/pa-dalign/index.html)
- [C++ Reference on Functional Programming](https://en.cppreference.com/w/cpp/utility/functional/function)
- [Valgrind Memory Leak Detection](http://valgrind.org/)

## Author
Youssef Ahmed
